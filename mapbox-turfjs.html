<!DOCTYPE html>
<html>

<head>
  <title>Studio Week 3</title>
  <!-- Add Mapbox GL JS JavaScript file -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
  <!-- Add in the Mapbox GL JS CSS file -->
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>
  <!-- Add CSS styling info for the map -->
  <style type="text/css">
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 200px;
      bottom: 0;
      width: 100%;
    }

  </style>
  <!-- Adding styling info for page layout by reading in a CSS file -->
  <link rel="stylesheet" href="styles.css">

</head>

<body>
<h1>Studio Week 3 <br> Analyze data with Turf.js and Mapbox GL JS </h1>
<!-- Add multiple pages to web page-->
<!-- active class displays the grey box around current page-->
<ul>
  <li><a href="index.html" target="_self">Output 1</a></li>
  <li><a href="mapbox-interaction.html" target="_self">Output 2</a></li>
  <li><a class="active" href="mapbox-turfjs.html" target="_self">Output 3</a></li>
</ul>
<br>

<!-- Add a div to give the map somewhere to go -->
<div id='map'></div>

<script>

mapboxgl.accessToken = 'pk.eyJ1IjoibXZhbmRlbmJ1cmc5MiIsImEiOiJja2U4d2R5dDAyMHhwMnpwOGl6OGs2bmZ3In0.bjkT9KX_g4RVv1voVkvRnw';
var map = new mapboxgl.Map({
  container: 'map', // container id
  style: 'mapbox://styles/mapbox/light-v10', // stylesheet location
  center: [-84.5, 38.05], // starting position
  zoom: 12 // starting zoom
  .featureLayer.setGeoJSON(geojson);
});
  
  
  
  
var hospitals = {
  type: 'FeatureCollection',
  features: [
    { type: 'Feature', properties: { Name: 'VA Medical Center -- Leestown Division', Address: '2250 Leestown Rd' }, geometry: { type: 'Point', coordinates: [-84.539487, 38.072916] } },
    { type: 'Feature', properties: { Name: 'St. Joseph East', Address: '150 N Eagle Creek Dr' }, geometry: { type: 'Point', coordinates: [-84.440434, 37.998757] } },
    { type: 'Feature', properties: { Name: 'Central Baptist Hospital', Address: '1740 Nicholasville Rd' }, geometry: { type: 'Point', coordinates: [-84.512283, 38.018918] } },
    { type: 'Feature', properties: { Name: 'VA Medical Center -- Cooper Dr Division', Address: '1101 Veterans Dr' }, geometry: { type: 'Point', coordinates: [-84.506483, 38.02972] } },
    { type: 'Feature', properties: { Name: 'Shriners Hospital for Children', Address: '1900 Richmond Rd' }, geometry: { type: 'Point', coordinates: [-84.472941, 38.022564] } },
    { type: 'Feature', properties: { Name: 'Eastern State Hospital', Address: '627 W Fourth St' }, geometry: { type: 'Point', coordinates: [-84.498816, 38.060791] } },
    { type: 'Feature', properties: { Name: 'Cardinal Hill Rehabilitation Hospital', Address: '2050 Versailles Rd' }, geometry: { type: 'Point', coordinates: [-84.54212, 38.046568] } },
    { type: 'Feature', properties: { Name: 'St. Joseph Hospital', ADDRESS: '1 St Joseph Dr' }, geometry: { type: 'Point', coordinates: [-84.523636, 38.032475] } },
    { type: 'Feature', properties: { Name: 'UK Healthcare Good Samaritan Hospital', Address: '310 S Limestone' }, geometry: { type: 'Point', coordinates: [-84.501222, 38.042123] } },
    { type: 'Feature', properties: { Name: 'UK Medical Center', Address: '800 Rose St' }, geometry: { type: 'Point', coordinates: [-84.508205, 38.031254] } }
  ]
};
var libraries = {
  type: 'FeatureCollection',
  features: [
    { type: 'Feature', properties: { Name: 'Village Branch', Address: '2185 Versailles Rd' }, geometry: { type: 'Point', coordinates: [-84.548369, 38.047876] } },
    { type: 'Feature', properties: { Name: 'Northside Branch', ADDRESS: '1733 Russell Cave Rd' }, geometry: { type: 'Point', coordinates: [-84.47135, 38.079734] } },
    { type: 'Feature', properties: { Name: 'Central Library', ADDRESS: '140 E Main St' }, geometry: { type: 'Point', coordinates: [-84.496894, 38.045459] } },
    { type: 'Feature', properties: { Name: 'Beaumont Branch', Address: '3080 Fieldstone Way' }, geometry: { type: 'Point', coordinates: [-84.557948, 38.012502] } },
    { type: 'Feature', properties: { Name: 'Tates Creek Branch', Address: '3628 Walden Dr' }, geometry: { type: 'Point', coordinates: [-84.498679, 37.979598] } },
    { type: 'Feature', properties: { Name: 'Eagle Creek Branch', Address: '101 N Eagle Creek Dr' }, geometry: { type: 'Point', coordinates: [-84.442219, 37.999437] } }
  ]
};

  
map.on('load', function() {
  map.addLayer({
    id: 'hospitals',
    type: 'symbol',
    source: {
      type: 'geojson',
      data: hospitals
    },
    layout: {
      'icon-image': 'hospital-15',
      'icon-allow-overlap': true
    },
    paint: { }
  });
  map.addLayer({
    id: 'libraries',
    type: 'symbol',
    source: {
      type: 'geojson',
      data: libraries
    },
    layout: {
      'icon-image': 'library-15'
    },
    paint: { }
  });
});
  
var punkvenues = {
type: "FeatureCollection",
features: [
{ "type": "Feature", "properties": { Name: "40 Watt Club", "Address": "285 W Washington St", "City": "Athens", "State": "GA", "Country": "United States", "Zipcode": "30601", "Latitude": 33.958309, "Longitude": -83.379959 }, "geometry": { "type": "Point", "coordinates": [ -83.379959, 33.958309 ] } },
{ "type": "Feature", "properties": { Name: "100 Club", "Address": "100 Oxford Street", "City": "London", "State": "", "Country": "United Kingdom", "Zipcode": "", "Latitude": 51.51613, "Longitude": -0.13528 }, "geometry": { "type": "Point", "coordinates": [ -0.13528, 51.51613 ] } },
{ "type": "Feature", "properties": { Name: "924 Gilman Street", "Address": "924 Gilman St", "City": "Berkeley", "State": "CA", "Country": "United States", "Zipcode": "94710", "Latitude": 37.879505, "Longitude": -122.299296 }, "geometry": { "type": "Point", "coordinates": [ -122.299296, 37.879505 ] } },
{ "type": "Feature", "properties": { Name: "A7 (bar)", "Address": "112 Avenue A", "City": "New York", "State": "NY", "Country": "United States", "Zipcode": "10009", "Latitude": 40.725892, "Longitude": -73.983467 }, "geometry": { "type": "Point", "coordinates": [ -73.983467, 40.725892 ] } },
{ "type": "Feature", "properties": { Name: "ABC No Rio", "Address": "56 Rivington St ", "City": "NY", "State": "NY", "Country": "United States", "Zipcode": "10002", "Latitude": 40.720779, "Longitude": -73.99039 }, "geometry": { "type": "Point", "coordinates": [ -73.99039, 40.720779 ] } },
{ "type": "Feature", "properties": { Name: "The Anthrax", "Address": "25 Perry Avenue", "City": "Norwalk", "State": "CT", "Country": "United States", "Zipcode": "6850", "Latitude": 41.135416, "Longitude": -73.428538 }, "geometry": { "type": "Point", "coordinates": [ -73.428538, 41.135416 ] } },
{ "type": "Feature", "properties": { Name: "Band on the Wall", "Address": "27 Swan St", "City": "Manchester ", "State": "", "Country": "United Kingdom", "Zipcode": "", "Latitude": 53.4864743, "Longitude": -2.2362478 }, "geometry": { "type": "Point", "coordinates": [ -2.2362478, 53.4864743 ] } },
{ "type": "Feature", "properties": { Name: "Brighton Bar", "Address": "121 Brighton Ave", "City": "Long Branch", "State": "NJ", "Country": "United States", "Zipcode": "7017", "Latitude": 40.284661, "Longitude": -73.987371 }, "geometry": { "type": "Point", "coordinates": [ -73.987371, 40.284661 ] } },
{ "type": "Feature", "properties": { Name: "The Casbah (music venue)", "Address": "2812 Kettner Blvd", "City": "San Diego", "State": "CA", "Country": "United States", "Zipcode": "92101", "Latitude": 32.73291, "Longitude": -117.173522 }, "geometry": { "type": "Point", "coordinates": [ -117.173522, 32.73291 ] } },
{ "type": "Feature", "properties": { Name: "CBGB", "Address": "315 Bowery", "City": "New York", "State": "NY", "Country": "United States", "Zipcode": "10003", "Latitude": 40.725176, "Longitude": -73.991985 }, "geometry": { "type": "Point", "coordinates": [ -73.991985, 40.725176 ] } },
{ "type": "Feature", "properties": { Name: "The Channel (nightclub)", "Address": "25 Necco St", "City": "Boston", "State": "MA", "Country": "United States", "Zipcode": "2210", "Latitude": 42.3495462, "Longitude": -71.0507133 }, "geometry": { "type": "Point", "coordinates": [ -71.0507133, 42.3495462 ] } },
{ "type": "Feature", "properties": { Name: "Charm City Art Space", "Address": "1731 Maryland Ave", "City": "Baltimore", "State": "MD", "Country": "United States", "Zipcode": "2120", "Latitude": 39.309531, "Longitude": -76.617547 }, "geometry": { "type": "Point", "coordinates": [ -76.617547, 39.309531 ] } },
{ "type": "Feature", "properties": { Name: "Ché Café", "Address": "1000 Scholars Dr S", "City": "La Jolla", "State": "CA", "Country": "United States", "Zipcode": "92037", "Latitude": 32.8741717, "Longitude": -117.2434312 }, "geometry": { "type": "Point", "coordinates": [ -117.2434312, 32.8741717 ] } },
{ "type": "Feature", "properties": { Name: "Club Waldorf", "Address": "444 Battery Street", "City": "San Francisco", "State": "CA", "Country": "United States", "Zipcode": "94111", "Latitude": 37.7956517, "Longitude": -122.400343 }, "geometry": { "type": "Point", "coordinates": [ -122.400343, 37.7956517 ] } },
{ "type": "Feature", "properties": { Name: "Cuckoo's Nest (nightclub)", "Address": "1714 Placentia Avenue", "City": "Costa Mesa", "State": "CA", "Country": "United States", "Zipcode": "", "Latitude": 33.6300635, "Longitude": -117.9318192 }, "geometry": { "type": "Point", "coordinates": [ -117.9318192, 33.6300635 ] } },
{ "type": "Feature", "properties": { Name: "The Echo (venue)", "Address": "1822 Sunset Blvd", "City": "Los Angeles", "State": "CA", "Country": "United States", "Zipcode": "90026", "Latitude": 34.077716, "Longitude": -118.260114 }, "geometry": { "type": "Point", "coordinates": [ -118.260114, 34.077716 ] } },
{ "type": "Feature", "properties": { Name: "F Club", "Address": "Leeds LS1 3HE", "City": "Leeds", "State": "", "Country": "United Kingdom", "Zipcode": "", "Latitude": 53.802968, "Longitude": -1.54784 }, "geometry": { "type": "Point", "coordinates": [ -1.54784, 53.802968 ] } },
{ "type": "Feature", "properties": { Name: "Les Foufounes Électriques", "Address": "87 St Catherine St E", "City": "Montreal", "State": "Quebec H2X 1K5", "Country": "Canada", "Zipcode": "", "Latitude": 45.510994, "Longitude": -73.563069 }, "geometry": { "type": "Point", "coordinates": [ -73.563069, 45.510994 ] } },
{ "type": "Feature", "properties": { Name: "The Great Gildersleeves", "Address": "331 Bowery", "City": "New York City", "State": "NY", "Country": "United States", "Zipcode": "10003", "Latitude": 40.725893, "Longitude": -73.9918594 }, "geometry": { "type": "Point", "coordinates": [ -73.9918594, 40.725893 ] } },
{ "type": "Feature", "properties": { Name: "Harpers Ferry (nightclub)", "Address": "58 Brighton Avenue", "City": "Allston", "State": "MA", "Country": "United States", "Zipcode": "2134", "Latitude": 42.35248, "Longitude": -71.128118 }, "geometry": { "type": "Point", "coordinates": [ -71.128118, 42.35248 ] } },
{ "type": "Feature", "properties": { Name: "Hong Kong Café", "Address": "425 Gin Ling Way", "City": "Los Angeles", "State": "CA", "Country": "United States", "Zipcode": "90012", "Latitude": 34.065559, "Longitude": -118.237138 }, "geometry": { "type": "Point", "coordinates": [ -118.237138, 34.065559 ] } },
{ "type": "Feature", "properties": { Name: "IMusicast", "Address": "5429 Telegraph Ave", "City": "Oakland", "State": "CA", "Country": "United States", "Zipcode": "94609", "Latitude": 37.8397563, "Longitude": -122.2618581 }, "geometry": { "type": "Point", "coordinates": [ -122.2618581, 37.8397563 ] } },
{ "type": "Feature", "properties": { Name: "Jabberjaw (Los Angeles)", "Address": "3711 W Pico Blvd", "City": "Los Angeles", "State": "CA", "Country": "United States", "Zipcode": "90019", "Latitude": 34.047513, "Longitude": -118.321793 }, "geometry": { "type": "Point", "coordinates": [ -118.321793, 34.047513 ] } },
{ "type": "Feature", "properties": { Name: "Lemp Neighborhood Arts Center", "Address": "3301 Lemp Ave", "City": "St. Louis", "State": "MO", "Country": "United States", "Zipcode": "63118", "Latitude": 38.594133, "Longitude": -90.21862 }, "geometry": { "type": "Point", "coordinates": [ -90.21862, 38.594133 ] } },
{ "type": "Feature", "properties": { Name: "Lucy's Record Shop", "Address": "1707 Church St.", "City": "Nashville", "State": "Tennessee", "Country": "United States", "Zipcode": "37203", "Latitude": 36.155339, "Longitude": -86.796333 }, "geometry": { "type": "Point", "coordinates": [ -86.796333, 36.155339 ] } },
{ "type": "Feature", "properties": { Name: "Mabuhay Gardens", "Address": "443 Broadway", "City": "San Francisco", "State": "CA", "Country": "United States", "Zipcode": "94133", "Latitude": 37.797891, "Longitude": -122.404499 }, "geometry": { "type": "Point", "coordinates": [ -122.404499, 37.797891 ] } },
{ "type": "Feature", "properties": { Name: "The Masque (venue)", "Address": "1655 North Cherokee Avenue", "City": "Los Angeles", "State": "CA", "Country": "United States", "Zipcode": "90028", "Latitude": 34.101122, "Longitude": -118.335145 }, "geometry": { "type": "Point", "coordinates": [ -118.335145, 34.101122 ] } },
{ "type": "Feature", "properties": { Name: "Max's Kansas City", "Address": "213 Park Ave St", "City": "New York", "State": "NY", "Country": "United States", "Zipcode": "10003", "Latitude": 40.736698, "Longitude": -73.98846 }, "geometry": { "type": "Point", "coordinates": [ -73.98846, 40.736698 ] } },
{ "type": "Feature", "properties": { Name: "The Middle East (nightclub)", "Address": "472-480 Massachusetts Ave", "City": "Cambridge", "State": "MA", "Country": "United States", "Zipcode": "2139", "Latitude": 42.363618, "Longitude": -71.10153 }, "geometry": { "type": "Point", "coordinates": [ -71.10153, 42.363618 ] } },
{ "type": "Feature", "properties": { Name: "Mr. Roboto Project", "Address": "5106 Penn Ave", "City": "Pittsburgh", "State": "PA", "Country": "United States", "Zipcode": "15224", "Latitude": 40.464702, "Longitude": -79.942511 }, "geometry": { "type": "Point", "coordinates": [ -79.942511, 40.464702 ] } },
{ "type": "Feature", "properties": { Name: "Mudd Club", "Address": "77 White St", "City": "New York", "State": "NY", "Country": "United States", "Zipcode": "10013", "Latitude": 40.717625, "Longitude": -74.002409 }, "geometry": { "type": "Point", "coordinates": [ -74.002409, 40.717625 ] } },
{ "type": "Feature", "properties": { Name: "Neo (nightclub)", "Address": "2350 N Clark St", "City": "Chicago", "State": "IL", "Country": "United States", "Zipcode": "60614", "Latitude": 41.925054, "Longitude": -87.640579 }, "geometry": { "type": "Point", "coordinates": [ -87.640579, 41.925054 ] } },
{ "type": "Feature", "properties": { Name: "O'Cayz Corral", "Address": "504 E Wilson St", "City": "Madison", "State": "WI", "Country": "United States", "Zipcode": "53703", "Latitude": 43.076021, "Longitude": -89.376828 }, "geometry": { "type": "Point", "coordinates": [ -89.376828, 43.076021 ] } },
{ "type": "Feature", "properties": { Name: "The Old Bar", "Address": "74-76 Johnston St", "City": "Fitzroy ", "State": "", "Country": "Australia", "Zipcode": "", "Latitude": -37.798363, "Longitude": 144.977084 }, "geometry": { "type": "Point", "coordinates": [ 144.977084, -37.798363 ] } },
{ "type": "Feature", "properties": { Name: "The Rathskeller", "Address": "528 Commonwealth Ave", "City": "Boston", "State": "MA", "Country": "United States", "Zipcode": "2215", "Latitude": 42.348516, "Longitude": -71.096222 }, "geometry": { "type": "Point", "coordinates": [ -71.096222, 42.348516 ] } },
{ "type": "Feature", "properties": { Name: "Raul's (night club)", "Address": "2610 Guadalupe St", "City": "Austin", "State": "TX", "Country": "United States", "Zipcode": "78705", "Latitude": 30.291548, "Longitude": -97.741473 }, "geometry": { "type": "Point", "coordinates": [ -97.741473, 30.291548 ] } },
{ "type": "Feature", "properties": { Name: "Rodney Bingenheimer's English Disco", "Address": "7561 Sunset Blvd", "City": "Los Angeles", "State": "CA", "Country": "United States", "Zipcode": "90046", "Latitude": 34.098201, "Longitude": -118.354387 }, "geometry": { "type": "Point", "coordinates": [ -118.354387, 34.098201 ] } },
{ "type": "Feature", "properties": { Name: "Self Help Graphics & Art", "Address": "1300 E 1st St", "City": "Los Angeles", "State": "CA", "Country": "United States", "Zipcode": "90033", "Latitude": 34.04746, "Longitude": -118.226544 }, "geometry": { "type": "Point", "coordinates": [ -118.226544, 34.04746 ] } },
{ "type": "Feature", "properties": { Name: "The Smell", "Address": "247 S Main St", "City": "Los Angeles", "State": "CA", "Country": "United States", "Zipcode": "90012", "Latitude": 34.050251, "Longitude": -118.245421 }, "geometry": { "type": "Point", "coordinates": [ -118.245421, 34.050251 ] } },
{ "type": "Feature", "properties": { Name: "SO36", "Address": "Oranienstraße 190", "City": "Berlin", "State": "", "Country": "Germany", "Zipcode": "", "Latitude": 52.500341, "Longitude": 13.422218 }, "geometry": { "type": "Point", "coordinates": [ 13.422218, 52.500341 ] } },
{ "type": "Feature", "properties": { Name: "Sound of Music (punk club)", "Address": "162 Turk St", "City": "San Francisco", "State": "CA", "Country": "United States", "Zipcode": "94102", "Latitude": 37.783365, "Longitude": -122.411833 }, "geometry": { "type": "Point", "coordinates": [ -122.411833, 37.783365 ] } },
{ "type": "Feature", "properties": { Name: "Starwood (nightclub)", "Address": "8151 Santa Monica Blvd", "City": "West Hollywood", "State": "CA", "Country": "United States", "Zipcode": "90046", "Latitude": 34.091091, "Longitude": -118.366648 }, "geometry": { "type": "Point", "coordinates": [ -118.366648, 34.091091 ] } },
{ "type": "Feature", "properties": { Name: "The Know (Portland, Oregon)", "Address": "3728 NE Sandy Blvd", "City": "Portland", "State": "OR", "Country": "United States", "Zipcode": "97232", "Latitude": 45.534054, "Longitude": -122.624261 }, "geometry": { "type": "Point", "coordinates": [ -122.624261, 45.534054 ] } },
{ "type": "Feature", "properties": { Name: "Tier 3", "Address": "West Broadway & White Street", "City": "New York", "State": "NY", "Country": "United States", "Zipcode": "10013", "Latitude": 40.718189, "Longitude": -74.003043 }, "geometry": { "type": "Point", "coordinates": [ -74.003043, 40.718189 ] } },
{ "type": "Feature", "properties": { Name: "The Tote Hotel", "Address": "71 Johnston St Port ", "City": "Melbourne", "State": "", "Country": "Australia", "Zipcode": "", "Latitude": -37.8437919, "Longitude": 144.9433 }, "geometry": { "type": "Point", "coordinates": [ 144.9433, -37.8437919 ] } },
{ "type": "Feature", "properties": { Name: "Triple Rock Social Club", "Address": "629 Cedar Ave", "City": "Minneapolis", "State": "MN", "Country": "United States", "Zipcode": "55454", "Latitude": 44.961225, "Longitude": -93.24725 }, "geometry": { "type": "Point", "coordinates": [ -93.24725, 44.961225 ] } },
{ "type": "Feature", "properties": { Name: "Valencia Tool & Die", "Address": "974 Valencia St", "City": "San Francisco", "State": "CA", "Country": "United States", "Zipcode": "94110", "Latitude": 37.75707, "Longitude": -122.421294 }, "geometry": { "type": "Point", "coordinates": [ -122.421294, 37.75707 ] } },
{ "type": "Feature", "properties": { Name: "Warm Water Cove", "Address": "300 24th St", "City": "San Francisco", "State": "CA", "Country": "United States", "Zipcode": "94107", "Latitude": 37.751642, "Longitude": -122.428475 }, "geometry": { "type": "Point", "coordinates": [ -122.428475, 37.751642 ] } },
{ "type": "Feature", "properties": { Name: "Whiskey A Go Go", "Address": "8901 Sunset Blvd", "City": "West Hollywood", "State": "CA", "Country": "United States", "Zipcode": "90069", "Latitude": 34.09064, "Longitude": -118.385512 }, "geometry": { "type": "Point", "coordinates": [ -118.385512, 34.09064 ] } }
]
};


    
  map.addSource('nearest-hospital', {
  type: 'geojson',
  data: {
    type: 'FeatureCollection',
    features: [
    ]
  }
});
    
var popup = new mapboxgl.Popup();

map.on('mousemove', function(e) {
  var features = map.queryRenderedFeatures(e.point, { layers: ['hospitals', 'libraries', 'punkvenues'] });
  if (!features.length) {
    popup.remove();
    return;
  }
  var feature = features[0];

  popup.setLngLat(feature.geometry.coordinates)
    .setHTML(feature.properties.Name)
    .addTo(map);

  map.getCanvas().style.cursor = features.length ? 'pointer' : '';
});
    
 map.on('click', function(e) {
  // Return any features from the 'libraries' layer whenever the map is clicked
  var libraryFeatures = map.queryRenderedFeatures(e.point, { layers: ['libraries'] });
  if (!libraryFeatures.length) {
    return;
  }
  var libraryFeature = libraryFeatures[0];

  // Using Turf, find the nearest hospital to library clicked
  var nearestHospital = turf.nearest(libraryFeature, hospitals);

  // If a nearest library is found
  if (nearestHospital !== null) {
    // Update the 'nearest-library' data source to include
    // the nearest library
    map.getSource('nearest-hospital').setData({
      type: 'FeatureCollection',
      features: [
        nearestHospital
      ]
    });
    // Create a new circle layer from the 'nearest-library' data source
    map.addLayer({
      id: 'nearest-hospital',
      type: 'circle',
      source: 'nearest-hospital',
      paint: {
        'circle-radius': 12,
        'circle-color': '#486DE0'
      }
    }, 'hospitals');
  }
});

  
  </script>
</body>

</html>
